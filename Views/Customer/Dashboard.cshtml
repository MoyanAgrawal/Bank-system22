@model BankSystem.Models.ViewModels.CustomerDashboardViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Employee.cshtml";
    var c = Model?.Customer;
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <span class="avatar rounded-circle bg-primary text-white p-3" style="font-weight:700">@c.CustID</span>
                        </div>
                        <div class="flex-grow-1">
                            <h4 class="mb-0">@c.CustName</h4>
                            <small class="text-muted">@c.CustID</small>
                            <div class="mt-2">
                                <span class="badge bg-info text-dark me-2">DOB: @c.DOB.ToString("dd-MMM-yyyy")</span>
                                <span class="badge bg-secondary me-2">PAN: @c.PAN</span>
                                <span class="badge bg-secondary">Phone: @c.PhoneNumber</span>
                            </div>
                        </div>
                        @if (Session["name"] != null)
                        {
                            <div class="text-end">
                                <a class="btn btn-outline-primary btn-sm" href="/Auth/Index">Logout</a>
                            </div>
                        }
                        
                    </div>
                </div>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header">
                            <strong>Savings Accounts</strong>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light">
                                        <tr><th>Account ID</th><th class="text-end">Balance</th><th>Opened</th></tr>
                                    </thead>
                                    <tbody>
                                        @if (!Model.SavingsAccounts.Any())
                                        {
                                            <tr><td colspan="3" class="text-center text-muted">No savings accounts</td></tr>
                                        }
                                        else
                                        {
                                            foreach (var s in Model.SavingsAccounts)
                                            {
                                                <tr>
                                                    <td>@s.SBAccountID</td>
                                                    <td class="text-end">@string.Format("{0:N2}", s.Balance)</td>
                                                    <td>@(s.CreatedAt is DateTime cad ? cad.ToString("dd-MMM-yyyy") : "")</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer small text-muted">Recent transactions shown below</div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header"><strong>Loan Accounts</strong></div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light"><tr><th>Loan ID</th><th class="text-end">Amount</th><th>Start</th><th class="text-end">EMI</th></tr></thead>
                                    <tbody>
                                        @if (!Model.LoanAccounts.Any())
                                        {
                                            <tr><td colspan="4" class="text-center text-muted">No loan accounts</td></tr>
                                        }
                                        else
                                        {
                                            foreach (var l in Model.LoanAccounts)
                                            {
                                                <tr>
                                                    <td>@l.LNAccountID</td>
                                                    <td class="text-end">@string.Format("{0:N2}", l.LoanAmount)</td>
                                                    <td>@(l.StartDate.ToString("dd-MMM-yyyy"))</td>
                                                    <td class="text-end">@string.Format("{0:N2}", l.EMIAmount)</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer small text-muted">Recent loan transactions shown below</div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mt-3">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-header"><strong>Fixed Deposits</strong></div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light"><tr><th>FD ID</th><th class="text-end">Amount</th><th>Start</th><th>End</th></tr></thead>
                                    <tbody>
                                        @if (!Model.FDAccounts.Any())
                                        {
                                            <tr><td colspan="4" class="text-center text-muted">No fixed deposits</td></tr>
                                        }
                                        else
                                        {
                                            foreach (var f in Model.FDAccounts)
                                            {
                                                <tr>
                                                    <td>@f.FDAccountID</td>
                                                    <td class="text-end">@string.Format("{0:N2}", f.DepositAmount)</td>
                                                    <td>@(f.StartDate.ToString("dd-MMM-yyyy"))</td>
                                                    <td>@(f.EndDate.ToString("dd-MMM-yyyy"))</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer small text-muted">FD portfolio</div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header"><strong>Recent Savings Transactions</strong></div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light"><tr><th>Date</th><th>AccID</th><th class="text-end">Amount</th><th>Type</th></tr></thead>
                                    <tbody>
                                        @if (!Model.SavingsTransactions.Any())
                                        {
                                            <tr><td colspan="4" class="text-center text-muted">No transactions</td></tr>
                                        }
                                        else
                                        {
                                            foreach (var t in Model.SavingsTransactions)
                                            {
                                                <tr>
                                                    <td>@(t.TransactionDate is DateTime sd ? sd.ToString("dd-MMM-yyyy") : "")</td>
                                                    <td>@t.SBAccountID</td>
                                                    <td class="text-end">@string.Format("{0:N2}", t.Amount)</td>
                                                    <td>@t.TransactionType</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header"><strong>Recent Loan Transactions</strong></div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light"><tr><th>Date</th><th>LoanID</th><th class="text-end">Amount</th><th>Outstanding</th></tr></thead>
                                    <tbody>
                                        @if (!Model.LoanTransactions.Any())
                                        {
                                            <tr><td colspan="4" class="text-center text-muted">No transactions</td></tr>
                                        }
                                        else
                                        {
                                            foreach (var t in Model.LoanTransactions)
                                            {
                                                <tr>
                                                    <td>@(t.EMIDate_Actual is DateTime ld ? ld.ToString("dd-MMM-yyyy") : "")</td>
                                                    <td>@t.LNAccountID</td>
                                                    <td class="text-end">@string.Format("{0:N2}", t.Amount)</td>
                                                    <td class="text-end">@string.Format("{0:N2}", t.Outstanding)</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>